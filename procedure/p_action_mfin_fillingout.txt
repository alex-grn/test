 CREATE  OR  REPLACE  FUNCTION  public.p_action_mfin_fillingout(mfin  integer,  begindate  date,  idlist  text)
  RETURNS  void
  LANGUAGE  plpgsql
AS  $function$
declare
    TMFIN            integer  :=  MFIN;  --переменная
    DBEGINDATE  date  :=  BEGINDATE;
    REC                record;
    SP                  record;
    NDATE            date;  --дата  начала
    EDATE            date;  --дата  конца
    NMFIN            BIGINT;  --id  таблицы  заполения;
begin
    for  REC  in  (select  S.ID  as  ELECTCOMMITTEEID  from  ELECTCOMMITTEE  S  where  S.ID  =  any(P_SYSTEM_GET_SELECTLIST(IDLIST)))
    loop
        update  MFIN  S
              set  ENDDATE  =  DBEGINDATE  -  1
          where  S.ELECTCOMMITTEEID  =  REC.ELECTCOMMITTEEID
              and  (S.BEGINDATE  <=  DBEGINDATE  and  (S.ENDDATE  >=  DBEGINDATE  or  S.ENDDATE  is  null));
        insert  into  MFIN  (ELECTCOMMITTEEID,  MFIN,  BEGINDATE)  values  (REC.ELECTCOMMITTEEID,  TMFIN,  DBEGINDATE);
    end  loop;
end;
$function$
 

 CREATE  OR  REPLACE  FUNCTION  public.p_action_sheets_roll_back(idlist  text)
  RETURNS  void
  LANGUAGE  plpgsql
AS  $function$
declare
    --Действие  "Расформировать  ведомость"  в  разделе  "Ведомости  по  оплате  труда"
    REC  record;
    NID  BIGINT;  --id  таблицы  заполения;
begin
    for  REC  in  (select  S.ID,
                                          S.REGISTERID
                                from  SHEETS  S
                              where  S.ID  =  any(P_SYSTEM_GET_SELECTLIST(IDLIST)))
    loop
        update  PAYS  P  set  SHEETSID  =  null  where  P.SHEETSID  =  REC.ID;
        update  REGISTER  set  STATUS  =  '3'  where  ID  =  REC.REGISTERID;
        delete  from  SHEETS  S  where  S.ID  =  REC.ID;
    end  loop;
end;
$function$
 

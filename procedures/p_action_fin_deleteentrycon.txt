CREATE OR REPLACE FUNCTION public.p_action_fin_deleteentrycon (
  idlist text
)
RETURNS void AS
$body$
declare
  RC    RECORD;
  JR    RECORD;
begin

  for RC in (
      select F.ID
        from MBT_CONTRACT f
       where f.ID = ANY(P_SYSTEM_GET_SELECTLIST(IDLIST))
  )
  LOOP
     delete from JURNALEXP j where exists (select 1
                                             from DOCLINKS d
                                            where d.TABLEIN ilike 'MBT_CONTRACT'
                                              and d.KEYIN = RC.ID
                                              and d.TABLEOUT ilike 'JURNALEXP'
                                              and d.KEYOUT = j.ID);
     PERFORM P_SYSTEM_DOCLINKS_DEL('MBT_CONTRACT',RC.ID,'JURNALEXP');
     PERFORM P_ACTION_SET_STATUS('MBT_CONTRACT',RC.ID::text,'0');
  END LOOP;
  
end;
$body$
LANGUAGE 'plpgsql'
VOLATILE
CALLED ON NULL INPUT
SECURITY INVOKER
COST 100;

ALTER FUNCTION public.p_action_fin_deleteentrycon (idlist text)
  OWNER TO magicbox;
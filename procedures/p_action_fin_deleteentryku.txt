CREATE OR REPLACE FUNCTION public.p_action_fin_deleteentryku (
  idlist text
)
RETURNS void AS
$body$
declare
  RC    RECORD;
  JR    RECORD;
begin

  for RC in (
      select F.ID
        from UFK_NOTIF f
       where f.ID = ANY(P_SYSTEM_GET_SELECTLIST(IDLIST))
  )
  LOOP
     FOR JR IN (
         select s.ID,
                'UFK_NOTIF_BA' as TABLE
           from UFK_NOTIF_BA s
          where s.UFK_NOTIFID = RC.ID
          union
         select s.ID,
                'UFK_NOTIF_LBO'
           from UFK_NOTIF_LBO s
          where s.UFK_NOTIFID = RC.ID
          union
         select s.ID,
                'UFK_NOTIF_POF'
           from UFK_NOTIF_POF s
          where s.UFK_NOTIFID = RC.ID 
     )
     LOOP
       delete from JURNALEXP j where j.id in (select d.keyout
                                                from DOCLINKS d
                                               where d.TABLEIN = 'UFK_NOTIF'
                                                 and d.KEYIN = RC.ID);
       PERFORM p_system_doclinks_del(JR.TABLE,JR.ID,'JURNALEXP');
       PERFORM p_system_doclinks_del('UFK_NOTIF',RC.ID,'JURNALEXP');
     END LOOP;  
     PERFORM p_action_set_status('UFK_NOTIF',RC.ID::text,'0');
  END LOOP;
  
end;
$body$
LANGUAGE 'plpgsql'
VOLATILE
CALLED ON NULL INPUT
SECURITY INVOKER
COST 100;

ALTER FUNCTION public.p_action_fin_deleteentryku (idlist text)
  OWNER TO magicbox;
 CREATE  OR  REPLACE  FUNCTION  public.p_action_import_reg_excel(spage  text,  ident  bigint)
  RETURNS  text
  LANGUAGE  plpgsql
AS  $function$
declare
    RC                  record;
    SCODEPAGE    TEXT  :=  'UTF-8';
    FILE_TEXT    TEXT;
    FILE_XML      XML;
    FILEBUF_ID  BIGINT;
begin

    select  max(F2.ID)  into  FILEBUF_ID  from  FILEBUFFER  F2  where  F2.CID  =  IDENT;

    select  P_SYSTEM_FILE_TO_TEXT(F.BFILE,  SCODEPAGE)  into  FILE_TEXT  from  FILEBUFFER  F  where  F.ID  =  FILEBUF_ID;

    if  FILE_TEXT  is  null  then
        raise
            using  MESSAGE  =  'Файл  не  найден.';
    end  if;

    begin
        FILE_XML  :=  cast(FILE_TEXT  as  XML);
    exception
        when  others  then
            raise
                using  MESSAGE  =  'Некорректная  структура  XML-файла.';
    end;

    return  null;

end;
$function$
 

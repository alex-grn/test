CREATE OR REPLACE FUNCTION public.p_action_mbt_report_form_notifmbt_rollback (
  idlist text
)
RETURNS void AS
$body$
declare
  rec   record;
begin
  
  for rec in (
      select k.id
        from MBT_REPORT k
       where k.id = any(p_system_get_selectlist(idlist))
  )  
  loop
     delete from notifmbt j where exists (select 1
                                             from DOCLINKS d
                                            where d.TABLEIN ilike 'MBT_REPORT'
                                              and d.KEYIN = rec.ID
                                              and d.TABLEOUT ilike 'NOTIFMBT'
                                              and d.KEYOUT = j.ID);
     PERFORM P_SYSTEM_DOCLINKS_DEL('MBT_REPORT',rec.ID,'NOTIFMBT');
  end loop;
end;
$body$
LANGUAGE 'plpgsql'
VOLATILE
CALLED ON NULL INPUT
SECURITY INVOKER
COST 100;

ALTER FUNCTION public.p_action_mbt_report_form_notifmbt_rollback (idlist text)
  OWNER TO magicbox;
 CREATE  OR  REPLACE  FUNCTION  public.p_action_registerlist_check_runtime(idlist  text)
  RETURNS  text
  LANGUAGE  plpgsql
AS  $function$
declare
    REC  record;
    PR    record;
begin

    for  REC  in  (select  S.COMMITTEEMANID,
                                          S.ID  as  REG_ID,
                                          W.TIMEBEGINTBL  ::time,
                                          W.TIMEENDTBL  ::time,
                                          (select  E.CODE
                                                from  REGISTER            R,
                                                          ELECTCAMPAIGN  E
                                              where  R.ID  =  S.REGISTERID
                                                  and  E.ID  =  R.ELECTCAMPAIGNID)  as  NAME_COMP,
                                          COALESCE(P.SURNAME,  '')  ||  '  '  ||  COALESCE(P.FIRSTNAME)  ||  '  '  ||  COALESCE(P.MIDDLENAME)  as  FIO_CH,
                                          TO_CHAR(W.DATETBL,  'dd.mm.yyyy')  as  DATETBL,
                                          W.DATETBL  as  DATETBLS
                                from  REGISTERLIST  S,
                                          WORKTBL            W,
                                          COMMITTEEMAN  C,
                                          PERSON              P
                              where  S.ID  =  any(P_SYSTEM_GET_SELECTLIST(IDLIST))
                                  and  W.REGISTERLISTID  =  S.ID
                                  and  C.ID  =  S.COMMITTEEMANID
                                  and  P.ID  =  C.PERSONID
                                  and  W.TIMEBEGINTBL  is  not  null
                                  and  W.TIMEENDTBL  is  not  null)
    loop
        for  PR  in  (select  W.TIMEBEGINTBL  ::time,
                                            W.TIMEENDTBL  ::time,
                                            (select  E.CODE
                                                  from  REGISTER            R,
                                                            ELECTCAMPAIGN  E
                                                where  R.ID  =  S.REGISTERID
                                                    and  E.ID  =  R.ELECTCAMPAIGNID)  as  NAME_COMP
                                  from  REGISTERLIST  S,
                                            WORKTBL            W
                                where  S.ID  !=  REC.REG_ID
                                    and  S.COMMITTEEMANID  =  REC.COMMITTEEMANID
                                    and  W.REGISTERLISTID  =  S.ID
                                    and  W.DATETBL  =  REC.DATETBLS
                                    and  (W.TIMEBEGINTBL::time  <=  REC.TIMEBEGINTBL  ::time  
                                              and  W.TIMEENDTBL  ::time  >  REC.TIMEBEGINTBL  ::time  
                                                or  W.TIMEBEGINTBL  ::time  <  REC.TIMEENDTBL::time  
                                              and  W.TIMEENDTBL::time  >=  REC.TIMEENDTBL::time  
                                                or  W.TIMEBEGINTBL::time  <=  REC.TIMEBEGINTBL::time  
                                              and  W.TIMEENDTBL::time  >=  REC.TIMEENDTBL::time)
                              )
        loop
            return  'Нарушение  периода  работы  члена  ИК:  Член  избирательной  комиссии  '  ||  REC.FIO_CH  ||  '  работал  '  ||  REC.DATETBL  ||  '  в  период  подготовки  и  проведения  выборов  '  ||  REC.NAME_COMP  ||  '  с  '  ||  REC.TIMEBEGINTBL  ::time  ||  '  до  '  ||  REC.TIMEENDTBL  ::time  ||  '  и  выборов  '  ||  PR.NAME_COMP  ||  '  с  '  ||  PR.TIMEBEGINTBL  ::time  ||  '  до  '  ||  PR.TIMEENDTBL  ::time  ||  '.';
        end  loop;
    end  loop;
    return  null;
end;
$function$
 

 CREATE  OR  REPLACE  FUNCTION  public.p_unloadproc()
  RETURNS  text
  LANGUAGE  plpgsql
AS  $function$
DECLARE
        RC  RECORD;
        RESULT  TEXT;
BEGIN
FOR  RC  IN  (
                        SELECT  P.PRONAME,P.PROSRC
                                                FROM  PG_PROC  P
                                              WHERE  P.PRONAME  NOT  ILIKE  'p_system%'
                                                  AND  P.PROSRC  ILIKE  '%end;%'
                                                  ORDER  BY  P.PRONAME
                        )
                      LOOP
                                      --BEGIN
                                      EXECUTE  
                                '  copy  (
                                            select  pg_get_functiondef(p.oid)
                                                from  pg_proc  p
                                              where  p.proname  =  '''||RC.PRONAME||''')
                                          to  ''C:/Z/unloadProc/'||RC.PRONAME||'.txt''    with  (format  csv,  quote  ''  '');';
                                --EXCEPTION  WHEN  OTHERS  THEN  NULL;
                                --END;
                      END  LOOP;  
                    
RETURN  'Успешно!';
      
END;
$function$
 

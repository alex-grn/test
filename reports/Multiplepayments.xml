<?xml version="1.0" encoding="UTF-8"?>
<report name="report">
    <templates>
        <template code="DEFAULT" documentName="Multiplepayments.xls" documentPath="Multiplepayments.xls" outputType="xls" outputNamePattern="Multiplepayments.xls"/>
    </templates>
    <rootBand name="Root" orientation="H">
        <bands>
		    <band name="Header" orientation="H">
				<queries>
                     <query name="Header" type="sql">
                        <script>
							select 'за период с '||
									 case ${repmonthby}::integer
									 when 1 then '€нварь'
									 when 2 then 'февраль'
									 when 3 then 'март'
									 when 4 then 'апрель'
									 when 5 then 'май'
									 when 6 then 'июнь'
									 when 7 then 'июль'
									 when 8 then 'август'
									 when 9 then 'сент€брь'
									 when 10 then 'окт€брь'
									 when 11 then 'но€брь'
									 when 12 then 'декабрь'
									 end
									 ||' '||${repyear}::text||' года'  as DATEREPORT,
									 (select d.name 
										from  MULTIPLEPAYMENTS f,
											  benefitstypedir d
									   where d.id = f.benefitstypenamedirid
										 and f.uid = ${uid}::bigint
									group by d.name) as names ;
						</script>
                     </query>
                </queries>
			</band>
			<band name="spec" orientation="H">
				<queries>
                     <query name="spec" type="sql">
                        <script>
							select COALESCE(s.lastname,'')||' '||COALESCE(s.firstname,'')||' '||COALESCE(s.patronymic,'') as ben,
								   ss.name||' ('||ff.periodpay||')' as reg, 
								   COALESCE(c.lastname,'')||' '||COALESCE(c.firstname,'')||' '||COALESCE(c.patronymic,'')||' / '||COALESCE(to_char(c.benefitchilddatebirth,'dd.mm.yyyy'),'') as child
							  from MULTIPLEPAYMENTS f,
								   MULTIPLEPAYMENTSFOOTER ff,
								   benefitsrecipients s,
								   benefitchild c,
							       subjectsdir ss
						     where ff.MULTIPLEPAYMENTSid = f.id
							   and s.id = f.benefitsrecipientsid
							   and c.id = ff.benefitchildid
							   and ss.id = ff.subjectsdirid
   							   and f.uid = ${uid}::bigint;
						</script>
                     </query>
                </queries>
			</band>				
        </bands>
        <queries/>
    </rootBand>
</report>
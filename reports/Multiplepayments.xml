<?xml version="1.0" encoding="UTF-8"?>
<report name="report">
    <templates>
        <template code="DEFAULT" documentName="Multiplepayments.xls" documentPath="Multiplepayments.xls" outputType="xls" outputNamePattern="Multiplepayments.xls"/>
    </templates>
    <rootBand name="Root" orientation="H">
        <bands>
			<band name="Header1" orientation="H"/>
		    <band name="Header2" orientation="H">
				<queries>
                     <query name="Header2" type="sql">
                        <script>
							select d.name as names
										from  MULTIPLEPAYMENTS f,
											  benefitstypedir d
									   where d.id = f.benefitstypenamedirid
										 and f.uid = ${uid}::bigint
                                         and 1 = (select count(*) over()
										from  MULTIPLEPAYMENTS f,
											  benefitstypedir d
									   where d.id = f.benefitstypenamedirid
										 and f.uid = ${uid}::bigint
									group by d.name 
                                    limit 1)
									group by d.name limit 1
								     ; 
						</script>
                     </query>
                </queries>
			</band>
			<band name="Header3" orientation="H">
				<queries>
                     <query name="Header3" type="sql">
                        <script>
							select 'за период с '||
									 case ${repmonthby}::integer
									 when 1 then '€нварь'
									 when 2 then 'февраль'
									 when 3 then 'март'
									 when 4 then 'апрель'
									 when 5 then 'май'
									 when 6 then 'июнь'
									 when 7 then 'июль'
									 when 8 then 'август'
									 when 9 then 'сент€брь'
									 when 10 then 'окт€брь'
									 when 11 then 'но€брь'
									 when 12 then 'декабрь'
									 end
									 ||' '||${repyear}::text||' года'  as DATEREPORT;
						</script>
                     </query>
                </queries>
			</band>
			<band name="spec" orientation="H">
				<queries>
                     <query name="spec" type="sql">
                        <script>
							select COALESCE(s.lastname,'')||' '||COALESCE(s.firstname,'')||' '||COALESCE(s.patronymic,'') as ben,
								   ss.name||' ('||ff.periodpay||')' as reg, 
								   COALESCE(c.lastname,'')||' '||COALESCE(c.firstname,'')||' '||COALESCE(c.patronymic,'')||' / '||COALESCE(to_char(c.benefitchilddatebirth,'dd.mm.yyyy'),'') as child
							  from MULTIPLEPAYMENTS f
                         left join MULTIPLEPAYMENTSFOOTER ff on ff.MULTIPLEPAYMENTSid = f.id
                         left join benefitsrecipients s on s.id = f.benefitsrecipientsid
                         left join benefitchild c on c.id = ff.benefitchildid
                         left join subjectsdir ss on ss.id = ff.subjectsdirid
						     where f.uid = ${uid}::bigint
							   order by ben,reg,child;
							   ;
						</script>
                     </query>
                </queries>
			</band>				
        </bands>
        <queries/>
    </rootBand>
</report>
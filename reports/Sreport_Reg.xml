<?xml version="1.0" encoding="UTF-8"?>
<report name="report">
    <templates>
        <template code="DEFAULT" documentName="Sreport_Reg.xls" documentPath="Sreport_Reg.xls" outputType="xls" outputNamePattern="Sreport_Reg.xls"/>
    </templates>
    <rootBand name="Root" orientation="H">
        <bands>
		    <band name="Header" orientation="H">
				<queries>
                     <query name="Header" type="sql">
                        <script>
							select 'за период с €нвар€ по '||
									 case ${repmonthby}::integer
									 when 1 then '€нварь'
									 when 2 then 'февраль'
									 when 3 then 'март'
									 when 4 then 'апрель'
									 when 5 then 'май'
									 when 6 then 'июнь'
									 when 7 then 'июль'
									 when 8 then 'август'
									 when 9 then 'сент€брь'
									 when 10 then 'окт€брь'
									 when 11 then 'но€брь'
									 when 12 then 'декабрь'
									 end
									 ||' '||${repyear}::text||' года'  as DATEREPORT,
									 (select s.name from SUBJECTSDIR s where s.id = ${subjectsdirid}::integer) as SUBJECTSDIR
						</script>
                     </query>
                </queries>
			</band>		
			<band name="spec" orientation="H">
				<queries>
                    <query name="spec" type="sql">
                        <script>
								select (select count(DISTINCT x.benefitsrecipientsid) from benefit01 x, benefitspackets xx where xx.id = x.benefitspacketsid and xx.repmonth::integer  between 1 and ${repmonthby}::integer and xx.repyear = ${repyear}::INTEGER) as beneficiaries,
								COALESCE(sum(COALESCE(p.paysum,0)),0) as benefits_paid,
								COALESCE(sum(COALESCE(p.extrasum,0)),0) as co_benefits,
								COALESCE(sum(COALESCE(p.returnsum,0)),0) as benefit_refund,
								COALESCE(sum(COALESCE(p.retentionsum,0)),0) as retention_of_benefits/*,
								COALESCE(sum(COALESCE(p.paysum,0)),0) as benefits_paid*/
							from benefit01 b,
								benefit01payment p,
								BENEFITSPACKETS z
							where p.benefit01id = b.id 
							and b.benefitspacketsid = z.id
							and z.subjectsdirid = ${subjectsdirid}::integer
							and Z.repmonth::integer between 1 and ${repmonthby}::integer
							and z.repyear = ${repyear}::INTEGER;
                        </script>
                    </query>
                </queries>
            </band>
			<band name="spec1" orientation="H">
				<queries>
                    <query name="spec1" type="sql">
                        <script>
							select (select count(DISTINCT x.benefitsrecipientsid) from benefit02 x, benefitspackets xx where xx.id = x.benefitspacketsid and xx.repmonth::integer  between 1 and ${repmonthby}::integer and xx.repyear = ${repyear}::INTEGER) as beneficiaries,
								COALESCE(sum(COALESCE(p.paysum,0)),0) as benefits_paid,
								COALESCE(sum(COALESCE(p.extrasum,0)),0) as co_benefits,
								COALESCE(sum(COALESCE(p.returnsum,0)),0) as benefit_refund,
								COALESCE(sum(COALESCE(p.retentionsum,0)),0) as retention_of_benefits
							from benefit02 b,
								benefit02payment p,
								BENEFITSPACKETS z
							where p.benefit02id = b.id 
							and b.benefitspacketsid = z.id
							and z.subjectsdirid = ${subjectsdirid}::integer
							and Z.repmonth::integer between 1 and ${repmonthby}::integer
							and z.repyear = ${repyear}::INTEGER
							;
                        </script>
                    </query>
                </queries>
            </band>
			<band name="spec2" orientation="H">
				<queries>
                    <query name="spec2" type="sql">
                        <script>
							select (select count(DISTINCT x.benefitsrecipientsid) from benefit03 x, benefitspackets xx where xx.id = x.benefitspacketsid and xx.repmonth::integer  between 1 and ${repmonthby}::integer and xx.repyear = ${repyear}::INTEGER) as beneficiaries,
								COALESCE(sum(COALESCE(p.paysum,0)),0) as benefits_paid,
								COALESCE(sum(COALESCE(p.extrasum,0)),0) as co_benefits,
								COALESCE(sum(COALESCE(p.returnsum,0)),0) as benefit_refund,
								COALESCE(sum(COALESCE(p.retentionsum,0)),0) as retention_of_benefits
							from benefit03 b,
								benefit03payment p,
								BENEFITSPACKETS z
							where p.benefit03id = b.id 
							and b.benefitspacketsid = z.id
							and z.subjectsdirid = ${subjectsdirid}::integer
							and Z.repmonth::integer between 1 and ${repmonthby}::integer
							and z.repyear = ${repyear}::INTEGER;
                        </script>
                    </query>
                </queries>
            </band>
			<band name="spec3" orientation="H">
				<queries>
                    <query name="spec3" type="sql">
                        <script>
							select (select count(DISTINCT x.benefitsrecipientsid) from benefit04 x, benefitspackets xx where xx.id = x.benefitspacketsid and xx.repmonth::integer  between 1 and ${repmonthby}::integer and xx.repyear = ${repyear}::INTEGER) as beneficiaries,
								COALESCE(sum(COALESCE(p.paysum,0)),0) as benefits_paid,
								COALESCE(sum(COALESCE(p.extrasum,0)),0) as co_benefits,
								COALESCE(sum(COALESCE(p.returnsum,0)),0) as benefit_refund,
								COALESCE(sum(COALESCE(p.retentionsum,0)),0) as retention_of_benefits
							from benefit04 b,
								benefit04payment p,
								BENEFITSPACKETS z
						  where p.benefit04id = b.id 
							and b.benefitspacketsid = z.id
							and z.subjectsdirid = ${subjectsdirid}::integer
							and Z.repmonth::integer between 1 and ${repmonthby}::integer
							and z.repyear = ${repyear}::INTEGER;
                        </script>
                    </query>
                </queries>
            </band>
			<band name="spec4" orientation="H">
				<queries>
                    <query name="spec4" type="sql">
                        <script>
							select (select count(DISTINCT x.benefitsrecipientsid) from benefit05 x, benefitspackets xx where xx.id = x.benefitspacketsid and xx.repmonth::integer  between 1 and ${repmonthby}::integer and xx.repyear = ${repyear}::INTEGER) as beneficiaries,
								COALESCE(sum(COALESCE(p.paysum,0)),0) as benefits_paid,
								COALESCE(sum(COALESCE(p.extrasum,0)),0) as co_benefits,
								COALESCE(sum(COALESCE(p.returnsum,0)),0) as benefit_refund,
								COALESCE(sum(COALESCE(p.retentionsum,0)),0) as retention_of_benefits
							from benefit05 b,
								benefit05payment p,
								BENEFITSPACKETS z
							where p.benefit05id = b.id 
							and b.benefitspacketsid = z.id
							and z.subjectsdirid = ${subjectsdirid}::integer
							and Z.repmonth::integer between 1 and ${repmonthby}::integer
							and z.repyear = ${repyear}::INTEGER;
                        </script>
                    </query>
                </queries>
            </band>
			<band name="spec5" orientation="H">
				<queries>
                    <query name="spec5" type="sql">
                        <script>
							select (select count(DISTINCT x.benefitsrecipientsid) from benefit06 x, benefitspackets xx where xx.id = x.benefitspacketsid and xx.repmonth::integer  between 1 and ${repmonthby}::integer and xx.repyear = ${repyear}::INTEGER) as beneficiaries,
								COALESCE(sum(COALESCE(p.paysum,0)),0) as benefits_paid,
								COALESCE(sum(COALESCE(p.extrasum,0)),0) as co_benefits,
								COALESCE(sum(COALESCE(p.returnsum,0)),0) as benefit_refund,
								COALESCE(sum(COALESCE(p.retentionsum,0)),0) as retention_of_benefits
							from benefit06 b,
								benefit06payment p,
								BENEFITSPACKETS z
							where p.benefit06id = b.id 
							and b.benefitspacketsid = z.id
							and z.subjectsdirid = ${subjectsdirid}::integer
							and Z.repmonth::integer between 1 and ${repmonthby}::integer
							and z.repyear = ${repyear}::INTEGER;
                        </script>
                    </query>
                </queries>
            </band>
			<band name="spec6" orientation="H">
				<queries>
                    <query name="spec6" type="sql">
                        <script>
							select (select count(DISTINCT x.benefitsrecipientsid) from benefit07 x, benefitspackets xx where xx.id = x.benefitspacketsid and xx.repmonth::integer  between 1 and ${repmonthby}::integer and xx.repyear = ${repyear}::INTEGER) as beneficiaries,
								COALESCE(sum(COALESCE(p.paysum,0)),0) as benefits_paid,
								COALESCE(sum(COALESCE(p.surchargesum,0)),0) as co_benefits,
								COALESCE(sum(COALESCE(p.refundsum,0)),0) as benefit_refund,
								COALESCE(sum(COALESCE(p.holdsum,0)),0) as retention_of_benefits
							from benefit07 b,
								benefit07payment p,
								BENEFITSPACKETS z
							where p.benefit07id = b.id 
							and b.benefitspacketsid = z.id
							and z.subjectsdirid = ${subjectsdirid}::integer
							and Z.repmonth::integer between 1 and ${repmonthby}::integer
							and z.repyear = ${repyear}::INTEGER;
                        </script>
                    </query>
                </queries>
            </band>
        </bands>
        <queries/>
    </rootBand>
</report>
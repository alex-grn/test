<?xml version="1.0" encoding="UTF-8"?>
<report name="report">
    <templates>
        <template code="DEFAULT" documentName="Multiplepayments.xls" documentPath="Multiplepayments.xls" outputType="xls" outputNamePattern="Multiplepayments.xls"/>
    </templates>
    <rootBand name="Root" orientation="H">
        <bands>
		    <band name="head" orientation="H">
				<queries>
                     <query name="head" type="sql">
                        <script>
							select 'за период с '||
									 case ${repmonthby}::integer
									 when 1 then '€нварь'
									 when 2 then 'февраль'
									 when 3 then 'март'
									 when 4 then 'апрель'
									 when 5 then 'май'
									 when 6 then 'июнь'
									 when 7 then 'июль'
									 when 8 then 'август'
									 when 9 then 'сент€брь'
									 when 10 then 'окт€брь'
									 when 11 then 'но€брь'
									 when 12 then 'декабрь'
									 end
									 ||' '||${repyear}::text||' года'  as DATEREPORT,
									 (select d.name 
										from  UNLAWFULSURCHARGE f,
											  benefitstypedir d
									   where d.id = f.benefitstypenamedirid
										 and f.uid = ${uid}::bigint
									group by d.name) as names ;
						</script>
                     </query>
                </queries>
			</band>
			<band name="spec" orientation="H">
				<queries>
                     <query name="spec" type="sql">
                        <script>
							 select COALESCE(s.lastname,'')||' '||COALESCE(s.firstname,'')||' '||COALESCE(s.patronymic,'') as fio,
								   ss.name||' ('||ff.periodpay||')' as region, 
                                   ff.periodextra as dop,
                                   t.name as category,
                                    p_action_search_remark_benefit(r.rosternumber,ff.periodpay::text,ff.periodextra::text,ss.id) as remark
							  from UNLAWFULSURCHARGE f
                         left join UNLAWFULSURCHARGEFOOTER ff on ff.unlawfulsurchargeid = f.id
                         left join benefitstypedir r on r.id = f.benefitstypenamedirid
                         left join benefitsrecipients s on s.id = f.benefitsrecipientsid
                         left join RECIPIENTSCATEGORIESDIR t on t.id = s.recipientscategoriesdirid
                         left join benefitchild c on c.id = ff.benefitchildid
                         left join subjectsdir ss on ss.id = ff.subjectsdirid
						     where f.uid = ${uid}::bigint
							   order by fio,region;
							   ;
						</script>
                     </query>
                </queries>
			</band>				
        </bands>
        <queries/>
    </rootBand>
</report>
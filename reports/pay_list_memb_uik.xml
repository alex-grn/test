<?xml version="1.0" encoding="UTF-8"?>
<report name="report">
    <templates>
        <template code="DEFAULT" documentName="pay_list_memb_uik" documentPath="pay_list_memb_uik" outputType="xlsx" outputNamePattern="pay_list_memb_uik"/>
	</templates>
    <rootBand name="Root" orientation="H">
        <bands>
            <band name="Header" orientation="H">
				<queries>			
			 <query name="header" type="sql">
                        <script>
/*
РїРѕ РѕР±СЂР°Р·С†Сѓ РѕС‚С‡РµС‚Р° sheet_calculation_tik Р Р°СЃС‡РµС‚РЅР°СЏ РІРµРґРѕРјРѕСЃС‚СЊ
Р—Р°РґР°РЅРёРµ: Р РµР°Р»РёР·РѕРІР°С‚СЊ РІРµРґРѕРјРѕСЃС‚Рё РЅР°С‡РёСЃР»РµРЅРёР№ РІРµРґРѕРјСЃС‚РІРµРЅРЅРѕРіРѕ РєРѕСЌС„С„РёС†РёРµРЅС‚Р° РїСЂРµРґСЃРµРґР°С‚РµР»СЏРј РЈРРљ, С‡Р»РµРЅР°Рј РўРРљ. 
РћС‚С‡РµС‚С‹ С„РѕСЂРјРёСЂСѓСЋС‚СЃСЏ РІ СЂР°Р·РґРµР»Рµ Р Р°СЃС‡РµС‚РЅС‹Рµ РґРѕРєСѓРјРµРЅС‚С‹. register РћС‚С‡РµС‚ С„РѕСЂРјРёСЂСѓРµС‚СЃСЏ РїРѕ 1 Р·Р°РїРёСЃРё.
Р’С…РѕРґСЏС‰РёРµ РїР°СЂР°РјРµС‚СЂС‹: 
РџСЂРµРґСЃРµРґР°С‚РµР»СЊ РР·Р±РёСЂР°С‚РµР»СЊРЅРѕР№ РєРѕРјРёСЃСЃРёРё вЂ“ Р·РґРµСЃСЊ РЅСѓР¶РµРЅ РІС‹Р±РѕСЂ РёР· СЃРїРµС†РёС„РёРєР°С†РёРё РћС‚РІРµС‚СЃС‚РІРµРЅРЅС‹Рµ Р»РёС†Р° РёР·Р±РёСЂР°С‚РµР»СЊРЅРѕР№ РєРѕРјРёСЃСЃРёРё.
Р‘СѓС…РіР°Р»С‚РµСЂ - Р·РґРµСЃСЊ РЅСѓР¶РµРЅ РІС‹Р±РѕСЂ РёР· СЃРїРµС†РёС„РёРєР°С†РёРё РћС‚РІРµС‚СЃС‚РІРµРЅРЅС‹Рµ Р»РёС†Р° РёР·Р±РёСЂР°С‚РµР»СЊРЅРѕР№ РєРѕРјРёСЃСЃРёРё.
РџРѕСЂСЏРґРѕРє С„РѕСЂРјРёСЂРѕРІР°РЅРёСЏ РѕС‚С‡РµС‚РѕРІ РѕРґРёРЅР°РєРѕРІ.
РќРµРѕР±С…РѕРґРёРјР° РїСЂРѕРІРµСЂРєР° РЅР° РєРѕСЂСЂРµРєС‚РЅРѕСЃС‚СЊ РІС‹Р±РѕСЂР° РѕС‚С‡РµС‚Р° РІ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё РѕС‚ С‚РёРїР° РґРѕРєСѓРјРµРЅС‚Р°. 
РџСЂРё РЅРµРІРµСЂРЅРѕРј РІС‹Р±РѕСЂРµ РІС‹РІРѕРґРёС‚СЊ РѕС€РёР±РєСѓ В«РќРµРІРµСЂРЅРѕ РІС‹Р±СЂР°РЅ С€Р°Р±Р»РѕРЅ РїРµС‡Р°С‚Рё РІРµРґРѕРјРѕСЃС‚Рё РґР»СЏ РґРѕРєСѓРјРµРЅС‚Р° С‚РёРїР° {С‚РёРї РґРѕРєСѓРјРµРЅС‚Р°}

РР·РјРµРЅРµРЅРёСЏ:
Р Р°СЃС‡РµС‚ РєРѕР»РѕРЅРєРё (sumpay_add_time) РќР°С‡РёСЃР»РµРЅРѕ РґРѕРїРѕР»РЅРё-С‚РµР»СЊРЅРѕР№ 
РѕРїР»Р°С‚С‹ С‚СЂСѓРґР° (РІРѕР·РЅР°РіСЂР°Р¶РґРµРЅРёСЏ) 
Р·Р° С„Р°РєС‚РёС‡РµСЃРєРё РѕС‚СЂР°Р±РѕС‚Р°РЅРЅРѕРµ РІСЂРµРјСЏ, СЂСѓР±.
1.РґР»СЏ С‡Р»РµРЅР° РєРѕРјРёСЃСЃРёРё:
РІ Р Р°СЃС‡РµС‚РЅРѕРј Р»РёСЃС‚Рµ (PAYS) РїРѕ С‚РµРєСѓС‰РµРјСѓ СЂР°СЃС‡РµС‚РЅРѕРјСѓ РґРѕРєСѓРјРµРЅС‚Сѓ
СЃСѓРјРјРёСЂСѓРµРј РІС‹РїР»Р°С‚С‹ 
РІС‹РїР»Р°С‚С‹ 'РќР°С‡РёСЃР»РµРЅРѕ Р”РћРў Р·Р° Р¤РћР’'
РІС‹РїР»Р°С‚С‹ 'Р”РћРў Р·Р° Р°РєС‚РёРІРЅСѓСЋ СЂР°Р±РѕС‚Сѓ'

2.РґР»СЏ РїСЂРµРґСЃРµРґР°С‚РµР»СЏ РєРѕРјРёСЃСЃРёРё (РЅРµ РІ СЌС‚РѕРј РѕС‚С‡РµС‚Рµ)
РЅР°С…РѕРґРёРј РёР·РІРёСЂР°С‚РµР»СЊРЅСѓСЋ РєР°РјРїР°РЅРёСЋ Рё РїРѕ РЅРµР№ РїРѕ РІСЃРµРј РёР·Р±РёСЂРєРѕРјР°Рј РёС‰РµРј СЃСѓРјРјС‹
РІС‹РїР»Р°С‚С‹ 'РќР°С‡РёСЃР»РµРЅРѕ Р”РћРў Р·Р° Р¤РћР’'  
РІС‹РїР»Р°С‚С‹ 'Р”РћРў Р·Р° Р°РєС‚РёРІРЅСѓСЋ СЂР°Р±РѕС‚Сѓ'
 */
select r.code,
	   ik.name,
       c.officialname
  from register r,
	   ELECTCOMMINCAMP k,
	   ELECTCAMPAIGN c,
	   ELECTCOMMITTEE ik,
	   REGIONSRF Reg
where r.id = any(P_SYSTEM_GET_SELECTLIST(${idlist}::text))
  and k.id = r.electcommincampid
  and c.id = k.electcampaignid
  and ik.id = k.electcommitteeid
  and reg.id = ik.regionsrfid;
						</script>
                     </query>
                </queries>
			</band>
            <band name="Title" orientation="H"/>			
            <band name="Spec" orientation="H">
                <queries>
                    <query name="myQuery" type="sql">
							<script>
SELECT ROW_NUMBER() OVER() AS PNUM,
       SP.POSTBEGINDATE,
       SP.POSTPRINT,
       SP.FIO,
       MAX(SP.V_COEF) AS DEPCOEFF,
       SUM(SP.N_SUM) AS SUMPAY,
       SUM(SP.N_SUM_A) AS SUMPAY_ADD_TIME
  FROM (SELECT CH.ID,
               CH.POSTBEGINDATE,
               P.POSTPRINT,
               COALESCE(PP.SURNAME, '') || ' ' || COALESCE(PP.FIRSTNAME, '') || ' ' || COALESCE(PP.MIDDLENAME, '') AS FIO,
               COALESCE(R.DEPCOEFF, 0) AS V_COEF,
               COALESCE((SELECT SUM(COALESCE(PP.SUMPAY, 0))
                          FROM PAYS          PP,
                               SLCOMPCHARGES S
                         WHERE PP.REGISTERLISTID IN (SELECT RL.ID
                                                       FROM REGISTERLIST RL, --'Члены избирательной комиссии по ведомости';
                                                            REGISTER     RRL, --'Расчетные документы';
                                                            DOCTYPES	 DOC
                                                      WHERE RRL.ID = RL.REGISTERID
                                                      	AND DOC.ID = RRL.DOCTYPEID
                                                        AND TRIM(LOWER(DOC.CODE)) = 'ведомость дот за активную работу членам тик'
                                                        AND RRL.ELECTCAMPAIGNID = IK.ID
                                                        AND RL.COMMITTEEMANID = R.COMMITTEEMANID)
                           AND S.ID = PP.SLCOMPCHARGESID
                           AND S.DESCRIPTION = 'EXTRAA'),
                        0) AS N_SUM,
               
               COALESCE((SELECT SUM(COALESCE(PP.SUMPAY, 0))
                          FROM PAYS          PP,
                               SLCOMPCHARGES S
                         WHERE PP.REGISTERLISTID IN (SELECT RL.ID
                                                       FROM REGISTERLIST RL, --'Члены избирательной комиссии по ведомости';
                                                            REGISTER     RRL, --'Расчетные документы';
                                                            DOCTYPES	 DOC
                                                      WHERE RRL.ID = RL.REGISTERID
                                                        AND DOC.ID = RRL.DOCTYPEID
                                                        --AND TRIM(LOWER(DOC.CODE)) = 'ведомость дот за активную работу членам тик'
                                                        AND RRL.ELECTCAMPAIGNID = IK.ID
                                                        AND RL.COMMITTEEMANID = R.COMMITTEEMANID)
                           AND S.ID = PP.SLCOMPCHARGESID
                           AND S.DESCRIPTION = 'SUMEXTRA12'),
                        0) AS N_SUM_A
          FROM REGISTERLIST    R,
               COMMITTEEMAN    CH,
               PERSON          PP,
               POSTS           P,
               REGISTER        RR,
               ELECTCAMPAIGN   IK,
               ELECTCOMMINCAMP I
         WHERE R.REGISTERID = any(P_SYSTEM_GET_SELECTLIST(${idlist}::text))
           AND CH.ID = R.COMMITTEEMANID
           AND PP.ID = CH.PERSONID
           AND CH.POSTSID = P.ID
           AND RR.ID = R.REGISTERID
           AND IK.ID = RR.ELECTCAMPAIGNID
           AND I.ID = RR.ELECTCOMMINCAMPID) SP
 GROUP BY SP.ID,
          SP.POSTBEGINDATE,
          SP.POSTPRINT,
          SP.FIO
 ORDER BY SP.POSTBEGINDATE,
          SP.POSTPRINT,
          SP.FIO;
						</script>
                    </query>
                </queries>
            </band>
            <band name="Footer" orientation="H">                
			    <queries>
                    <query name="myQuery" type="sql">
							<script>
							select ( select name from PERSON where id= ${supervisor}::bigint )::text as supervisor,( select name from PERSON where id=  ${accountant}::bigint )::text as accountant
							</script>
                    </query>
                </queries>
            </band>
			
        </bands>
    </rootBand>
</report>
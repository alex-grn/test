<?xml version="1.0" encoding="UTF-8"?>
<report name="report">
    <templates>
        <template code="DEFAULT" documentName="print_card_direction.xlsx" documentPath="print_card_direction.xlsx" outputType="xlsx" outputNamePattern="print_card_direction.xlsx"/>
    </templates>
    <rootBand name="Root" orientation="H">
        <bands>
		    <band name="header" orientation="H">
				<queries>
                     <query name="header" type="sql">
                        <script>
							select R.name as name_reg,
								p.yearconscription as god
							from DIRECTION d
							left join ORGANIZATION org on org.id = d.organizationid
							left join ORGANIZATIONDIR o on o.id = org.organizationdirid
                            left join regiondir R ON r.id = o.regiondirid
							left join citizenry c on c.id = d.citizenryid
							left join PLANS p on p.id = c.plansid
							where d.id = ANY(P_SYSTEM_GET_SELECTLIST(${idlist}))
							limit 1
   							   ;
						</script>
                     </query>
                </queries>
			</band>
			<band name="spec" orientation="H">
				<queries>
                     <query name="spec" type="sql">
                        <script>
							 select row_number() over() as num,
									COALESCE(c.lastname,'')||' '||COALESCE(c.firstname,'')||' '||COALESCE(c.patronymic,'')  as fio,
									to_char(c.birthdate,'dd.mm.yyyy') as date_burn,
									case e.LEVELEDUCATION
										when '1' then 'Дошкольное образование'
										when '2' then 'Начальное общее образование'
										when '3' then 'Основное общее образование'
										when '4' then 'Среднее (полное) общее образование'
										when '5' then 'Начальное профессиональное образование'
										when '6' then 'Среднее профессиональное образование'
										when '7' then 'Неполное высшее образование'
										when '8' then 'Высшее образование'
										when '9' then 'Послевузовское образование'
									end as education,
									sp.namespec as special,
									case c.SUITABILITY
										when '1' then 'А'
										when '2' then 'Б'
										when '3' then 'В'
										when '4' then 'Г'
										when '5' then 'Д'
									end as godn,
									c.ENLISTMENT as name_vk,
									r.name as reg_priz,
									o.inn||', '||o.name as okpo,
									case dep.levelsignificance
										when '1' then 'Федеральный орган исполнительной власти'
										when '2' then 'Орган исполнительной власти субъектов Российской Федерации'
									end as name_government,
									COALESCE(r2.code,'')||' '||COALESCE(r2.name,'') as object_rf,
									COALESCE(o.SETTLEMENT,'')||' '||COALESCE(o.STREET,'')||' '||COALESCE(o.HOUSE,'')||' '||COALESCE(o.HOUSING,'')||' '||COALESCE(o.BUILDING,'') as adr_org,
									o.PHONEORG as tel_org,
									case v.housing
										when '1' then 'Не предосталяется'
										when '2' then 'Предосталяется'
									end as zhil,
									COALESCE(pr.codeprof::text,'')||', '||COALESCE(pr.name,'') as okpdtr,
									case v.QUALIFICATION
										when '1' then '1 разряд'
										when '2' then '2 разряд'
										when '3' then '3 разряд'
										when '4' then '4 разряд'
										when '5' then '5 разряд'
										when '6' then '6 разряд'
										when '7' then '7 разряд'
										when '8' then '8 разряд'
										when '9' then '9 разряд'
										when '10' then '10 разряд'
									end as kval,
									case v.leveleducation 
										when '1' then 'Дошкольное образование'
										when '2' then 'Начальное общее образование'
										when '3' then 'Основное общее образование'
										when '4' then 'Среднее (полное) общее образование'
										when '5' then 'Начальное профессиональное образование'
										when '6' then 'Среднее профессиональное образование'
										when '7' then 'Неполное высшее образование'
										when '8' then 'Высшее образование'
										when '9' then 'Послевузовское образование'
									end as education_requirements,
									case v.TRAINING
										when '1' then 'Возможность обучения'
										when '2' then 'Обязательно наличие опыта'
									end as educ_work,
									case v.WORKINGCONDITIONS 
										when '1' then 'Нормальные'
										when '2' then 'Тяжелые и вредные'
										when '3' then 'Особо тяжелые и особо вредные'
									end as working_conditions,
									m.name as operating_mode,
									v.MAINFUNCTION as work_description,
									v.TARIFFRATE as t_stavka
								from DIRECTION d
								inner join citizenry c on c.id = d.citizenryid 
								left join EDUCATIONCIT e on e.citizenryid = c.id and e.hidedate = (select max(x.hidedate) from educationcit x where x.citizenryid = e.citizenryid)
								left join SPECIALTYEDUCATIONDIR sp on sp.id = e.specialtyeducationdirid
								left join REGIONDIR r on r.id = c.regiondirid
								left join ORGANIZATION org on org.id = d.organizationid
								left join ORGANIZATIONDIR o on o.id = org.organizationdirid
								left join DEPARTMENTDIR dep on dep.id = o.departmentdirid
								left join REGIONDIR r2 on r2.id = o.regiondirid 
								left join VACANCYORG v on v.id = d.vacancyorgid
								left join PROFESSIONDIR pr on pr.id = v.PROFESSIONDIRID
								left join MODEWORKDIR m on m.id = v.modeworkdirid
								where d.id = ANY(P_SYSTEM_GET_SELECTLIST(${idlist}))
   							   ;
						</script>
                     </query>
                </queries>
			</band>
        </bands>
        <queries/>
    </rootBand>
</report>